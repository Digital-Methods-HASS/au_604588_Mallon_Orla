---
title: "CDS Assignment 6"
author: "Orla Mallon"
date: "26/10/2020"
output: html_document
---

Practicing Functions: 
1. Define a defensive function that calculates the Gross Domestic Product of a nation from the data available in the gapminder dataset. Using that function, calculate the GDP of Denmark in the following years: 1967, 1977, 1987, 1997, 2007, and 2017

2. Write a script that loops over each country in the gapminder dataset, tests whether the country starts with a ‘B’ , and print out whether the life expectancy is smaller than 50, between 50 and 70, or greater than 70.

```{r setup, include=FALSE}
#Loading up the packages 
library(tidyverse)
library(ggplot2)
library(gganimate)
install.packages("gapminder")
library(gapminder)

#The data is stored already in R with gapminder. We can explore what's in here using the function "head" which allows us to inspect it: 
head(gapminder)
##This tells us we have the country, continent, year, lifeExp, population and gdpPercap. For simplicity we'll make a tibble with the data; 
data <- data_frame(gapminder)

#We want to write a defensive function which will allow us to calculate the GDP of a country
#This can be done by multiplying the gdp per capita by the population, and including a stop clause if no data is present
#We also want to be able to define by country and year to give us more meaningful results, so we define these within the parenthesis with a Null value. 
#This means if there is a value found in that cell when the function runs through, it'll use the given value, else it will use NULL. 

calcGDP <- function(data, year=NULL, country=NULL) { #The stop function 
  if(!is.null(year)) {
    data <- data[data$year %in% year, ]
  }
  if (!is.null(country)) {
    data <- data[data$country %in% country,]
  }
  gdp <- data$pop * data$gdpPercap
  
  
  new <- cbind(data, gdp=gdp)
  return(new)
}

#What is Denmarks GDP in the following years: 1967, 1977, 1987, 1997, 2007, and 2017. 
#Code
calcGDP(gapminder, country="Denmark", year = "1967") #77116977700
calcGDP(gapminder, country="Denmark", year = "1977") #103920280028
calcGDP(gapminder, country="Denmark", year = "1987") #128771236166
calcGDP(gapminder, country="Denmark", year = "1997") #157476118456
calcGDP(gapminder, country="Denmark", year = "2007") #192906627081
calcGDP(gapminder, country = "Denmark", year = "2017") #Error - data not entered 

#Could also write more elegantly as: 
#calcGDP(gapminder, country = "Denmark", year = c(1967, 1977, 1987, 1997, 2007, 2017)

#Quetion 2: Life expectancy of countries beginning with the letter "B"
#We need to do this in a number of steps. First we'll find the countries which begin with "B" using the grep () function
#This asks R to run through the unique country names and if they begin with B, they are included.
#We'll put these into a new variable called candidate countries: This tells us there are 11 countries beginning with B.
candidateCountries <- as.data.frame(grep("^B", unique(gapminder$country), value=TRUE))

#Next we need to set the thresholds for the life expectancy: 
lowerThreshold <- 50
upperThreshold <- 70

#We then want to write our for-loop which will run through and calculate life expectancy
#This will be in 2 steps i) Calculate the average life expectancy of the country ii) print out where it falls on the scale 
for (iCountry in candidateCountries) {
  tmp <- mean(gapminder[gapminder$country == iCountry, "lifeExp"])
  
  if(tmp < lowerThreshold){
    cat("Average Life Expectancy in", iCountry, "is less than", lowerThreshold, "\n")
  }
  else if(tmp > lowerThreshold && tmp < upperThreshold){
    cat("Average Life Expectancy in", iCountry, "is between", lowerThreshold, "and", upperThreshold, "\n")
  }
  else{
    cat("Average Life Expectancy in", iCountry, "is greater than", upperThreshold, "\n")
  }
  rm(tmp)
}

#Question 3: Write a script that loops over each country in the gapminder dataset, tests whether the country starts with a ‘M’ 
#and graphs life expectancy against time (using plot() function) as a line graph if the mean life expectancy is under 50 years.

thresholdValue <- 50
candidateCountries2 <- grep("^M", unique(gapminder$country), value=TRUE)

for (iCountry in candidateCountries2) {
  tmp <- mean(gapminder[gapminder$country == iCountry, "lifeExp"])
  
  if(tmp < thresholdValue){
    cat("Average Life Expectancy in", iCountry, "is less than", thresholdValue, "plotting life expectancy graph... \n")
    
    with(subset(gapminder, country==iCountry),
         plot(year, lifeExp,
              type="o",
              main = paste("Life Expectancy in", iCountry, "over time"),
              ylab = "Life Expectancy",
              xlab = "Year"
         ) # end plot
    ) # end with
  } # end for loop
  rm(tmp)
}




```


